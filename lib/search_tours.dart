import 'dart:convert';
import 'dart:io';

import 'package:http/http.dart' as http;

Future main() async {
  const coordinates = [
    46.195602,
    6.148113,
    47.366667,
    8.55,
    47.558395,
    7.573271,
    46.916667,
    7.466667,
    46.533333,
    6.666667,
    47.083333,
    8.266667,
    46.009279,
    8.955576,
    47.43162,
    9.39845,
    46.856753,
    9.526918,
    47.697316,
    8.634929,
    46.79572,
    7.154748,
    46.993089,
    6.93005,
    46.270839,
    7.317785,
    47.172421,
    8.517445,
    47.55993,
    8.8998,
    46.194902,
    9.024729,
    47.389616,
    8.052354,
    47.38271,
    9.27186,
    47.206649,
    7.516605,
    47.027858,
    8.656112,
    47.482779,
    7.742975,
    47.366429,
    7.329005,
    46.898509,
    8.250681,
    46.880422,
    8.644409,
    46.97731,
    8.34005,
    47.04057,
    9.068036,
    47.328414,
    9.409647,
    47.255435,
    6.994608,
    47.281224,
    8.45346,
    46.488301,
    6.730109,
    46.696483,
    6.918037,
    47.043835,
    7.27357,
    46.796756,
    10.305946,
    46.903265,
    6.582135,
    47.30998,
    8.11371,
    46.95805,
    8.36609,
    47.337551,
    9.084078,
    46.777908,
    6.635502,
    46.953019,
    6.83897,
    47.31591,
    7.693047,
    47.478042,
    7.616417,
    47.19927,
    8.85432,
    46.82201,
    6.93608,
    47.478029,
    8.302764,
    47.589169,
    8.289621,
    46.814829,
    7.218519,
    47.369308,
    9.367519,
    46.642498,
    6.637324,
    47.228942,
    8.833889,
    46.619499,
    7.056743,
    47.518898,
    8.536967,
    47.43639,
    9.388615,
    47.460507,
    9.04389,
    47.289945,
    7.947274,
    46.465264,
    6.841168,
    46.539894,
    6.588096,
    47.481527,
    8.203014,
    47.559248,
    8.060446,
    47.104417,
    6.828892,
    47.594829,
    8.679678,
    47.404446,
    8.394984,
    47.50564,
    8.72413,
    46.751176,
    7.621663,
    47.059533,
    6.752278,
    47.352604,
    8.329955,
    46.660138,
    9.57883,
    46.218257,
    7.003196,
    47.057356,
    6.894757,
    46.956112,
    7.487187,
    46.849125,
    6.845805,
    46.58782,
    7.64751,
    47.270428,
    8.3382,
    46.92684,
    7.110343,
    47.553587,
    7.793839,
    46.994189,
    8.524996,
    46.951613,
    8.017235,
    46.489557,
    7.259609,
    47.357058,
    7.909101,
    46.834827,
    9.450752,
    47.47788,
    8.99569,
    47.255924,
    8.598672,
    47.119362,
    7.991459,
    47.477166,
    9.485434,
    46.511255,
    6.495693,
    46.683872,
    7.866376,
    47.170881,
    8.111132,
    47.085571,
    8.442057,
    47.56571,
    9.10701,
    47.365728,
    8.78595,
    47.270429,
    8.643675,
    46.93936,
    7.78738,
    47.650512,
    9.175038,
    47.129167,
    7.238464,
    46.945308,
    9.57218,
    46.773071,
    9.204486,
    47.12802,
    8.74319,
    47.231995,
    7.654479,
    47.29702,
    8.84348,
    47.168408,
    8.291788,
    46.697524,
    9.440202,
    47.384048,
    8.181798,
    47.480247,
    8.45628,
    46.355548,
    8.044112,
    46.491704,
    8.272063,
    46.101915,
    7.073989,
    46.3145,
    7.985796,
    46.797752,
    9.82702,
    47.352097,
    8.716687,
    47.376433,
    9.554989,
    47.179369,
    7.072954,
    47.415327,
    7.075221,
    46.6622885,
    6.2428399
  ];

  final List<String> ids = [];

  for (int i = 0; i < coordinates.length; i += 2) {
    final lat = coordinates[i];
    final lon = coordinates[i + 1];
    final List<String> list = await getIds(lat, lon);

    for (final element in list) {
      if (!ids.contains(element)) {
        ids.add(element);
      }
    }

    print('total: ${ids.length} - $i/${coordinates.length}');
  }

  File('ids.csv').writeAsString(ids.toString());
  print(ids);
}

Future<List<String>> getIds(double lat, double lon) async {
  print('loading: $lat,$lon');

  final List<String> result = [];
  final String url =
      'https://www.komoot.com/api/v007/smart_tours/?sport=mtb&max_distance=20000&lat=$lat&lon=$lon&items_range=0-99&hl=en';

  final response = await http.get(url);

  if (response.statusCode == 200) {
    final json = jsonDecode(response.body) as List<dynamic>;

    for (final element in json) {
      result.add('${element['id']}');
    }
  } else {
    print(response.statusCode);
  }

  print('found: ${result.length}');

  return result;
}
